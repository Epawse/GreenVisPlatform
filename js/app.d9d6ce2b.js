(function(){var e={9499:function(e,t,a){"use strict";var s=a(3751),i=a(9505),r=(a(4188),a(7354)),o=(a(2488),a(9393)),n=a(641);function l(e,t){const a=(0,n.g2)("router-view");return(0,n.uX)(),(0,n.Wv)(a)}var c=a(6262);const d={},u=(0,c.A)(d,[["render",l]]);var h=u,g=a(5220),m=a(33);const p=e=>((0,n.Qi)("data-v-e6f882d2"),e=e(),(0,n.jt)(),e),f={class:"header"},w=p((()=>(0,n.Lk)("div",{class:"logo"},[(0,n.Lk)("img",{src:"/icon.png",alt:"Logo Icon",class:"logo-icon"}),(0,n.Lk)("span",null,"城市绿色空间展示平台")],-1))),b={class:"nav"},y={class:"container"},v={class:"map-wrapper"},k=p((()=>(0,n.Lk)("div",{id:"mapDom",class:"map"},null,-1))),A={id:"popup",class:"ol-popup"},S=p((()=>(0,n.Lk)("a",{href:"#",id:"popup-closer",class:"ol-popup-closer"},null,-1))),F=p((()=>(0,n.Lk)("div",{id:"popup-content"},null,-1))),_=[S,F],C={class:"chart-panel"},E={class:"chart-header"},L={class:"chart-body-1"},G={class:"chart-body-2"},T={class:"demonstration"},I={class:"suggestion-panel"},x=["innerHTML"],V={key:0,class:"basemap-container"},O=["onClick"],M=["src","alt"],j={class:"toolbar"},P=p((()=>(0,n.Lk)("div",{class:"legend"},[(0,n.Lk)("img",{src:"/images/legend3.png",alt:"Legend",style:{}})],-1))),D={key:0,class:"geojson-viewer"},W={class:"clearfix"},N=p((()=>(0,n.Lk)("span",null,"GeoJSON 查看",-1))),R={class:"attribute-panel"};function z(e,t,a,i,r,o){const l=(0,n.g2)("el-cascader"),c=(0,n.g2)("el-option"),d=(0,n.g2)("el-select"),u=(0,n.g2)("el-button"),h=(0,n.g2)("el-table-column"),g=(0,n.g2)("el-table"),p=(0,n.g2)("el-image"),S=(0,n.g2)("el-button-group"),F=(0,n.g2)("vue-json-pretty"),z=(0,n.g2)("el-card"),B=(0,n.g2)("el-checkbox");return(0,n.uX)(),(0,n.CE)(n.FK,null,[(0,n.Lk)("div",f,[w,(0,n.Lk)("div",b,[(0,n.bF)(l,{modelValue:r.selectedDataType,"onUpdate:modelValue":t[0]||(t[0]=e=>r.selectedDataType=e),placeholder:"请选择数据类型",options:r.typeOptions,props:{expandTrigger:"hover"},size:"large",style:{width:"240px"}},null,8,["modelValue","options"]),(0,n.bF)(d,{modelValue:r.selectedYear,"onUpdate:modelValue":t[1]||(t[1]=e=>r.selectedYear=e),placeholder:"请选择数据年份",size:"large",style:{width:"240px"}},{default:(0,n.k6)((()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(r.yearOptions,(e=>((0,n.uX)(),(0,n.Wv)(c,{key:e,label:e,value:e,disabled:o.isYearDisabled(e)},null,8,["label","value","disabled"])))),128))])),_:1},8,["modelValue"]),(0,n.bF)(d,{modelValue:r.selectedPolicy,"onUpdate:modelValue":t[2]||(t[2]=e=>r.selectedPolicy=e),placeholder:"请选择政策",size:"large",style:{width:"240px"},disabled:r.isPolicyDisabled},{default:(0,n.k6)((()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(r.policyOptions,(e=>((0,n.uX)(),(0,n.Wv)(c,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","disabled"]),(0,n.bF)(u,{onClick:t[3]||(t[3]=e=>o.loadShp()),size:"large"},{default:(0,n.k6)((()=>[(0,n.eW)("确定")])),_:1}),(0,n.bF)(u,{onClick:t[4]||(t[4]=e=>o.toggleChart()),size:"large",class:(0,m.C4)({active:r.chartVisible})},{default:(0,n.k6)((()=>[(0,n.eW)("查看图表")])),_:1},8,["class"]),(0,n.bF)(u,{onClick:t[5]||(t[5]=e=>o.toggleSeggestion()),size:"large",class:(0,m.C4)({active:r.suggestionVisible})},{default:(0,n.k6)((()=>[(0,n.eW)("查看建议")])),_:1},8,["class"]),(0,n.bF)(u,{onClick:t[6]||(t[6]=e=>o.toggleBasemap()),size:"large"},{default:(0,n.k6)((()=>[(0,n.eW)("底图")])),_:1})])]),(0,n.Lk)("div",y,[(0,n.Lk)("div",v,[k,(0,n.bo)((0,n.Lk)("div",A,_,512),[[s.aG,r.isSelecting]]),(0,n.bo)((0,n.Lk)("div",C,[(0,n.bo)((0,n.Lk)("div",E,[(0,n.Lk)("span",null,(0,m.v_)(r.selectedYear)+" 年绿地可达性与公平性指标",1),(0,n.Lk)("i",{class:"el-icon-close",onClick:t[7]||(t[7]=e=>r.chartVisible=!1)})],512),[[s.aG,r.chartVisible]]),(0,n.bo)((0,n.Lk)("div",L,[(0,n.bF)(g,{data:r.tableData,height:"300",style:{width:"100%"}},{default:(0,n.k6)((()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(r.tableHeaders,((e,t)=>((0,n.uX)(),(0,n.Wv)(h,{key:t,prop:e,label:e},null,8,["prop","label"])))),128))])),_:1},8,["data"])],512),[[s.aG,r.chart_1_visible]]),(0,n.bo)((0,n.Lk)("div",G,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(r.images,((t,a)=>((0,n.uX)(),(0,n.CE)("div",{key:t,class:"block"},[(0,n.Lk)("span",T,(0,m.v_)(r.demonstrations[a]),1),(0,n.bF)(p,{style:{width:"200px",height:"130px"},src:t,fit:e.fill},null,8,["src","fit"])])))),128))],512),[[s.aG,r.chart_2_visible]])],512),[[s.aG,r.chartVisible]]),(0,n.bo)((0,n.Lk)("div",I,[(0,n.Lk)("div",{innerHTML:r.suggestionContent},null,8,x)],512),[[s.aG,r.suggestionVisible]]),r.basemapVisible?((0,n.uX)(),(0,n.CE)("div",V,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(r.basemaps,(e=>((0,n.uX)(),(0,n.CE)("div",{key:e.name,class:"basemap-item",onClick:t=>o.setBasemap(e.name)},[(0,n.Lk)("img",{src:e.thumbnail,alt:e.name},null,8,M),(0,n.Lk)("span",null,(0,m.v_)(e.name),1)],8,O)))),128))])):(0,n.Q3)("",!0),(0,n.Lk)("div",j,[(0,n.bF)(S,{class:"button-group",vertical:""},{default:(0,n.k6)((()=>[(0,n.bF)(u,{onClick:t[8]||(t[8]=e=>o.drawFeature("Point"))},{default:(0,n.k6)((()=>[(0,n.eW)("画点")])),_:1}),(0,n.bF)(u,{onClick:t[9]||(t[9]=e=>o.drawFeature("LineString"))},{default:(0,n.k6)((()=>[(0,n.eW)("画线")])),_:1}),(0,n.bF)(u,{onClick:t[10]||(t[10]=e=>o.drawFeature("Polygon"))},{default:(0,n.k6)((()=>[(0,n.eW)("画面")])),_:1})])),_:1}),(0,n.bF)(S,{class:"button-group",vertical:""},{default:(0,n.k6)((()=>[(0,n.bF)(u,{onClick:t[11]||(t[11]=e=>o.undo())},{default:(0,n.k6)((()=>[(0,n.eW)("撤回")])),_:1}),(0,n.bF)(u,{onClick:t[12]||(t[12]=e=>o.resetStatus())},{default:(0,n.k6)((()=>[(0,n.eW)("取消")])),_:1}),(0,n.bF)(u,{onClick:t[13]||(t[13]=e=>o.clearDrawLayer())},{default:(0,n.k6)((()=>[(0,n.eW)("清除")])),_:1}),(0,n.bF)(u,{onClick:t[14]||(t[14]=e=>o.measureDistance())},{default:(0,n.k6)((()=>[(0,n.eW)("测距")])),_:1})])),_:1}),(0,n.bF)(S,{class:"button-group",vertical:""},{default:(0,n.k6)((()=>[(0,n.bF)(u,{onClick:t[15]||(t[15]=e=>o.selectFeature())},{default:(0,n.k6)((()=>[(0,n.eW)("选择")])),_:1}),(0,n.bF)(u,{onClick:t[16]||(t[16]=e=>o.translateFeature())},{default:(0,n.k6)((()=>[(0,n.eW)("平移")])),_:1}),(0,n.bF)(u,{onClick:t[17]||(t[17]=e=>o.editVertices())},{default:(0,n.k6)((()=>[(0,n.eW)("编辑")])),_:1}),(0,n.bF)(u,{onClick:t[18]||(t[18]=e=>o.rotateFeature())},{default:(0,n.k6)((()=>[(0,n.eW)("旋转")])),_:1})])),_:1})]),P]),r.geoJSONViewerVisible?((0,n.uX)(),(0,n.CE)("div",D,[(0,n.bF)(z,null,{default:(0,n.k6)((()=>[(0,n.Lk)("div",W,[N,(0,n.bF)(u,{onClick:o.closeGeoJSONViewer,type:"text",class:"close-button"},{default:(0,n.k6)((()=>[(0,n.eW)("X")])),_:1},8,["onClick"])]),(0,n.Lk)("div",null,[(0,n.bF)(F,{data:r.parsedGeoJSON,deep:3,selectableType:"single",highlightMouseoverNode:!0,path:"res"},null,8,["data"])])])),_:1})])):(0,n.Q3)("",!0)]),(0,n.Lk)("div",R,[(0,n.bF)(g,{data:r.features,style:{width:"100%"},"max-height":"100%"},{default:(0,n.k6)((()=>[(0,n.bF)(h,{prop:"id",label:"ID",width:"180"}),(0,n.bF)(h,{prop:"type",label:"类型",width:"120"}),(0,n.bF)(h,{prop:"area",label:"面积(m²)",width:"120"}),(0,n.bF)(h,{prop:"selected",label:"选中",width:"80"},{default:(0,n.k6)((e=>[(0,n.bF)(B,{modelValue:e.row.selected,"onUpdate:modelValue":t=>e.row.selected=t,onChange:t=>o.onFeatureSelectChange(e.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),(0,n.bF)(h,{label:"操作"},{default:(0,n.k6)((t=>[(0,n.bF)(u,{size:"small",onClick:e=>o.locateFeature(t.row)},{default:(0,n.k6)((()=>[(0,n.eW)("定位")])),_:2},1032,["onClick"]),(0,n.bF)(u,{size:"small",type:"danger",onClick:e=>o.deleteFeature(t.row)},{default:(0,n.k6)((()=>[(0,n.eW)("删除")])),_:2},1032,["onClick"]),(0,n.bF)(u,{size:"small",onClick:e=>o.viewFeatureGeoJSON(t.row)},{default:(0,n.k6)((()=>[(0,n.eW)("查看")])),_:2},1032,["onClick"]),(0,n.bF)(u,{size:"small",onClick:e=>o.exportFeatureGeoJSON(t.row)},{default:(0,n.k6)((()=>[(0,n.eW)("导出")])),_:2},1032,["onClick"]),"shp"===t.row.type?((0,n.uX)(),(0,n.Wv)(u,{key:0,size:"small",onClick:a=>e.viewAttributeTable(t.row)},{default:(0,n.k6)((()=>[(0,n.eW)("查看属性表")])),_:2},1032,["onClick"])):(0,n.Q3)("",!0)])),_:1})])),_:1},8,["data"])])],64)}a(4114),a(4603),a(7566),a(8721);var B=a(402),Y=a(6637),$=a(7933),J=a(3707),U=a(4216),X=a(9276),Z=a(3628),q=a(3334),H=a(7733),Q=a(2770),K=a(4458),ee=a(9132),te=a(71),ae=a(915),se=a(8704),ie=a(1312),re=a(2490),oe=a(1854),ne=a(1795),le=a(7551),ce=a.n(le),de=a(1764),ue=a(6494),he=a(4078),ge=a(7434),me=a(9308),pe=a(9186),fe=a(9439),we=a(1727),be=a(3965),ye=a(1067),ve=a(2977),ke=a(6933),Ae=a(7896),Se=a(702),Fe=a(2660);function _e(e){let t,a="AvehefmVM_surC2UyDjyO2T_EvSgRUA9Te3_9D_sj88ZYEBNNWxaufCSPGzecf-B";switch(e){case"OSM":t=new Ae.A;break;case"Satellite":t=new Se.A({url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",maxZoom:19});break;case"Tian":t=new Se.A({url:"http://t{0-7}.tianditu.gov.cn/vec_c/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=vec&STYLE=default&TILEMATRIXSET=c&FORMAT=tiles&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&tk=719a5d3d8f259e8c5554d3fbb491fbdb",maxZoom:18,projection:"EPSG:4326"});break;case"Gaode":t=new Se.A({url:"http://webst01.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}",maxZoom:18});break;case"Bing":a="AvehefmVM_surC2UyDjyO2T_EvSgRUA9Te3_9D_sj88ZYEBNNWxaufCSPGzecf-B",t=new Fe.A({key:a,imagerySet:"RoadOnDemand"});break;case"GeoJSON":t=new U.A({url:"../data/line.geojson",format:new ie.A({dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"})});break;default:t=new Ae.A}return t}var Ce=_e,Ee=a(6950),Le=a(6758),Ge=a(9507),Te=[12890594.86,8362377.87,5591021,3481989.83,1678043.12,0],Ie=[75,60,45,30,15,0],xe=[[1.410526172116255e-8,898305509648872e-20,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,17337981.2],[-7.435856389565537e-9,8983055097726239e-21,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,10260144.86],[-3.030883460898826e-8,898305509983578e-20,.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,6856817.37],[-1.981981304930552e-8,8983055099779535e-21,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,4482777.06],[3.09191371068437e-9,8983055096812155e-21,6995724062e-14,23.10934304144901,-.00023663490511,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,2555164.4],[2.890871144776878e-9,8983055095805407e-21,-3.068298e-8,7.47137025468032,-353937994e-14,-.02145144861037,-1234426596e-14,.00010322952773,-323890364e-14,826088.5]],Ve=[[-.0015702102444,111320.7020616939,0x60e374c3105a3,-0x24bb4115e2e164,0x5cc55543bb0ae8,-0x7ce070193f3784,0x5e7ca61ddf8150,-0x261a578d8b24d0,0x665d60f3742ca,82.5],[.0008277824516172526,111320.7020463578,647795574.6671607,-4082003173.641316,10774905663.51142,-15171875531.51559,12053065338.62167,-5124939663.577472,913311935.9512032,67.5],[.00337398766765,111320.7020202162,4481351.045890365,-23393751.19931662,79682215.47186455,-115964993.2797253,97236711.15602145,-43661946.33752821,8477230.501135234,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837.749470245,992013.7397791013,-1221952.21711287,1340652.697009075,-620943.6990984312,144416.9293806241,37.5],[-.0003441963504368392,111320.7020576856,278.2353980772752,2485758.690035394,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-.0003218135878613132,111320.7020701615,.00369383431289,823725.6402795718,.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,.37238884252424,7.45]];function Oe(e){var t=new Re(e[0],e[1]),a=je(t);return[a.lng,a.lat]}function Me(e){var t=new Re(e[0],e[1]),a=Pe(t);return[a.lng,a.lat]}function je(e){var t,a;e.lng=We(e.lng,-180,180),e.lat=De(e.lat,-74,74),t=new Re(e.lng,e.lat);for(var s=0;s<Ie.length;s++)if(t.lat>=Ie[s]){a=Ve[s];break}if(!a)for(s=Ie.length-1;s>=0;s--)if(t.lat<=-Ie[s]){a=Ve[s];break}var i=Ne(e,a);e=new Re(i.lng.toFixed(2),i.lat.toFixed(2));return e}function Pe(e){var t,a;t=new Re(Math.abs(e.lng),Math.abs(e.lat));for(var s=0;s<Te.length;s++)if(t.lat>=Te[s]){a=xe[s];break}var i=Ne(e,a);e=new Re(i.lng.toFixed(6),i.lat.toFixed(6));return e}function De(e,t,a){return null!=t&&(e=Math.max(e,t)),null!=a&&(e=Math.min(e,a)),e}function We(e,t,a){while(e>a)e-=a-t;while(e<t)e+=a-t;return e}function Ne(e,t){if(e&&t){var a=t[0]+t[1]*Math.abs(e.lng),s=Math.abs(e.lat)/t[9],i=t[2]+t[3]*s+t[4]*s*s+t[5]*s*s*s+t[6]*s*s*s*s+t[7]*s*s*s*s*s+t[8]*s*s*s*s*s*s;return a*=e.lng<0?-1:1,i*=e.lat<0?-1:1,new Re(a,i)}}function Re(e,t){isNaN(e)&&(e=ze(e),e=isNaN(e)?0:e),Be(e)&&(e=parseFloat(e)),isNaN(t)&&(t=ze(t),t=isNaN(t)?0:t),Be(t)&&(t=parseFloat(t)),this.lng=e,this.lat=t}function ze(e){var t,a,s,i,r,o="",n="",l="",c=0,d=/[^A-Za-z0-9\+\/\=]/g;if(!e||d.exec(e))return e;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{s=cf.indexOf(e.charAt(c++)),i=cf.indexOf(e.charAt(c++)),r=cf.indexOf(e.charAt(c++)),l=cf.indexOf(e.charAt(c++)),t=s<<2|i>>4,a=(15&i)<<4|r>>2,n=(3&r)<<6|l,o+=String.fromCharCode(t),64!=r&&(o+=String.fromCharCode(a)),64!=l&&(o+=String.fromCharCode(n)),t=a=n="",s=i=r=l=""}while(c<e.length);return o}function Be(e){return"string"==typeof e}Re.isInRange=function(e){return e&&e.lng<=180&&e.lng>=-180&&e.lat<=74&&e.lat>=-74},Re.prototype.equals=function(e){return e&&lat==e.lat&&lng==e.lng};var Ye=a(7916),$e=a(1531),Je=a(6763);let Ue="719a5d3d8f259e8c5554d3fbb491fbdb",Xe="AvehefmVM_surC2UyDjyO2T_EvSgRUA9Te3_9D_sj88ZYEBNNWxaufCSPGzecf-B";function Ze(){let e=new ge.MF({code:"BD:09",extent:[-20037726.37,-11708041.66,20037726.37,12474104.17],units:"m",axisOrientation:"neu",global:!1});(0,ge.bF)(e),(0,ge.hB)("EPSG:4326",e,(function(e){return Oe(e)}),(function(e){return Me(e)}));let t=[];for(let r=0;r<=18;r++)t[r]=Math.pow(2,18-r);let a=new Le.A({origin:[0,0],resolutions:t}),s=new Ge.A({projection:e,tileGrid:a,tileUrlFunction:function(e){if(!e)return"";let t,a,s=e[0],i=e[1],r=e[2];return t=i<0?i:"M"+-i,a=-r,Je.log("BD-09: ",i,r),Je.log("WGS84: ",t,a),"http://online3.map.bdimg.com/onlinelabel/?qt=tile&x="+t+"&y="+a+"&z="+s+"&styles=pl&udt=20151021&scaler=1&p=1"}}),i=new ye.A({source:s});return i}function qe(){const e=(0,ae.RG)((0,ge.Jt)("EPSG:4326").getExtent())/256,t=[],a=[];for(let i=0;i<19;i++)t.push(e/Math.pow(2,i)),a.push(i);const s=new $e.A({origin:[-180,90],resolutions:t,matrixIds:a});return new ye.A({properties:{name:"wmts",title:"WMTS服务"},source:new Ye.A({url:`http://t{0-7}.tianditu.gov.cn/vec_c/wmts?tk=${Ue}`,projection:"EPSG:4326",tileGrid:s,crossOrigin:"*",format:"image/png",layer:"vec",matrixSet:"c",style:"default"})})}function He(e){let t;switch(e){case"OSM":t=new ye.A({properties:{name:"osm",title:"OpenStreetMap地图"},source:new Ae.A});break;case"ArcGIS":t=new ye.A({properties:{name:"arc",title:"Arcgis地图"},source:new Se.A({url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",maxZoom:19})});break;case"Tian":t=new ye.A({properties:{name:"tian",title:"天地图"},source:new Se.A({projection:"EPSG:4326",url:`http://t{0-7}.tianditu.gov.cn/vec_c/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=vec&STYLE=default&TILEMATRIXSET=c&FORMAT=tiles&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&tk=${Ue}`})});break;case"Gaode":t=new ye.A({properties:{name:"gaode",title:"高德地图"},source:new Se.A({url:"http://webrd0{1-4}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scl=1&style=8&lstyle=7&x={x}&y={y}&z={z}"})});break;case"Google":t=new ye.A({properties:{name:"google",title:"谷歌地图"},source:new Se.A({url:"http://mt{0-3}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}",projection:"EPSG:3857"})});break;case"Bing":t=new ye.A({properties:{name:"bing",title:"Bing地图"},source:new Fe.A({key:Xe,imagerySet:"RoadOnDemand"})});break;case"Baidu":t=Ze();break;case"WMTS":t=qe();break;default:t=new ye.A({properties:{name:"osm",title:"OpenStreetMap地图"},source:new Ae.A})}return t}var Qe=He,Ke=a(1888),et=a(163),tt=a(6763);ue.A.defs("EPSG:4326","+proj=longlat +datum=WGS84 +no_defs"),ue.A.defs("EPSG:3857","+proj=merc +lon_0=0 +k=1 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs"),(0,he.kz)(ue.A);var at={components:{VueJsonPretty:ce()},name:"",data(){return{map:{},drawSource:new U.A,drawVector:{},draw:{},features:[],idList:[],checks:[],layers:[],undoStack:[],view:null,zoom:null,center:null,rotation:null,miniMap:null,measureInteraction:null,olmap:null,scale:null,modify:null,translate:null,transform:null,defaultStyle:null,select:null,selectedFeatures:[],isSelecting:!1,geoJSONViewerVisible:!1,selectedFeatureGeoJSON:null,parsedGeoJSON:null,selectedDataType:[],isPolicyDisabled:!1,selectedYear:"",selectedPolicy:"noFactor",typeOptions:[{value:"landuse",label:"土地利用",children:[{value:"train",label:"训练数据"},{value:"predict",label:"预测数据"}]},{value:"greenAccessibility",label:"绿地可达性",children:[{value:"walk",label:"步行绿地可达性"},{value:"near",label:"近邻绿地可达性"},{value:"car",label:"驾车绿地可达性"},{value:"sum",label:"总体绿地可达性"}]},{value:"greenEquity",label:"绿地公平性"},{value:"others",label:"其他数据"}],policyOptions:[{value:"noFactor",label:"无政策"},{value:"withFactor",label:"有政策"}],yearOptions:["2014","2030","2040","2050"],shpLayer:null,chartVisible:!1,chart_1_visible:!0,chart_2_visible:!1,chartData:[],images:[],demonstrations:[],tableData:[],tableHeaders:[],suggestionVisible:!1,suggestionContent:"",basemapVisible:!1,basemaps:[{name:"OSM",thumbnail:a(1815)},{name:"ArcGIS",thumbnail:a(587)},{name:"Tian"},{name:"Gaode"},{name:"Baidu"},{name:"Bing"},{name:"Google"},{name:"WMTS"},{name:"None"}],isPredict:!0,attributeTableVisible:!1,attributeData:[],attributeColumns:[],myStyle:new X.Ay({fill:new Z.A({color:"rgba(245, 243, 240, 0.6)"}),stroke:new q.A({color:"#ffcc33",width:2}),image:new H.A({radius:7,fill:new Z.A({color:"#ffcc33"})})})}},watch:{selectedDataType(e){const t=e[e.length-1],a=e[0];tt.log(a,t),"landuse"===a&&"train"===t?(this.isPredict=!1,this.isPolicyDisabled=!0):(this.isPredict=!0,this.isPolicyDisabled=!1),this.resetSelectedYear()}},mounted(){this.initMap(),this.addDrawLayer(),this.resetStatus()},methods:{isYearDisabled(e){return this.isPredict?"2030"!==e&&"2040"!==e&&"2050"!==e:"2014"!==e},resetSelectedYear(){this.isYearDisabled(this.selectedYear)&&(this.isPredict?this.selectedYear="2030":(this.selectedYear="2014",this.selectedPolicy="noFactor"))},toggleBasemap(){this.basemapVisible=!this.basemapVisible},setBasemap(e){const t=this.map.getLayers();if(t.forEach((e=>{e instanceof ye.A&&this.map.removeLayer(e)})),"None"===e)return void(this.basemapVisible=!1);let a;a=Qe(e),this.map.getLayers().insertAt(0,a),this.basemapVisible=!1},loadShp(){if(0!==this.selectedDataType.length&&this.selectedYear)if(!this.selectedPolicy&&this.isPredict)this.$message.error("请选择政策类型");else{let e,t;switch(this.selectedDataType[0]){case"landuse":t="Landuse";break;case"greenAccessibility":t="GreenAccessibility";break;case"greenEquity":t="GreenEquity";break;case"others":t="Others";break}e=`http://localhost:8080/geoserver/${t}/wms`;const a={LAYERS:`${t}:${this.selectedDataType[0]}_${this.selectedDataType[1]}_${this.selectedPolicy}_${this.selectedYear}`,TILED:!0,STYLES:`${this.selectedDataType[0]}_${this.selectedDataType[1]}_style`};let s,i,r;tt.log(a),this.shpLayer&&this.map.removeLayer(this.shpLayer),this.shpLayer=new ye.A({properties:{name:`${this.selectedDataType[0]}_${this.selectedDataType[1]}_${this.selectedPolicy}_${this.selectedYear}`},source:new me.A({url:e,params:a,serverType:"geoserver",transition:0,projection:"EPSG:4326"})}),this.map.addLayer(this.shpLayer),s="landuse"===this.selectedDataType[0]?"/geojson/greenAccessibility_2030.geojson":`/geojson/${this.selectedDataType[0]}_${this.selectedYear}.geojson`,fetch(s).then((e=>e.json())).then((e=>{const t=(new ie.A).readFeatures(e);let a;i=new U.A,i.addFeatures(t),a=new X.Ay({fill:new Z.A({color:"rgba(0, 0, 0, 0)"}),stroke:new q.A({color:"rgba(0,0,0,0)",width:.5})}),r=new J.A({source:i,style:a}),r.setZIndex(1e3),this.map.addLayer(r),this.map.getView().fit(i.getExtent())})).catch((e=>{tt.error("获取GeoJSON数据失败:",e)}))}else this.$message.error("请选择政策类型和数据年份")},toggleChart(){this.chartVisible?this.chartVisible=!1:this.showChart()},toggleSeggestion(){this.suggestionVisible?this.suggestionVisible=!1:this.showSeggestion()},showSeggestion(){this.suggestionVisible=!0;const e=`/suggestions/suggestion_${this.selectedYear}.txt`;fetch(e).then((e=>e.text())).then((e=>{this.suggestionContent=e,this.suggestionContent=this.suggestionContent.replace(/\n/g,"<br>")})).catch((e=>{et.nk.error("加载建议内容失败"),tt.error("Error loading suggestion content:",e)}))},showChart(){if(!this.selectedYear||0===this.selectedDataType.length)return this.$message.error("请选择数据类型和数据年份"),void(this.chartVisible=!1);if("greenEquity"===this.selectedDataType[0]){this.chartVisible=!0,this.chart_1_visible=!1,this.chart_2_visible=!0;const e=document.querySelector(".chart-header");e.innerHTML="绿地公平性指标";let t="/images/步行公平性.png",a="/images/驾车公平性.png",s="/images/近邻公平性.png",i="/images/总体公平性.png";this.images=[t,a,s,i],this.demonstrations=["步行公平性","驾车公平性","近邻公平性","总体公平性"]}else{if("greenAccessibility"!==this.selectedDataType[0])return this.chartVisible=!1,this.chart_1_visible=!1,this.chart_2_visible=!1,void this.$message.error("暂无数据");{this.chartVisible=!0,this.chart_1_visible=!0,this.chart_2_visible=!1;const e=document.querySelector(".chart-header");e.innerHTML=`${this.selectedYear} 年绿地可达性指标`;const t=`/tables/分区统计Aij_${this.selectedYear}.csv`;Ke.fu7(t).then((e=>{this.loadTable(e)})).catch((e=>{et.nk.error("加载表格数据失败"),tt.error("Error loading table data:",e)}))}}},loadTable(e){e.length>0?(this.tableHeaders=Object.keys(e[0]),this.tableData=e):et.nk.error("表格数据为空")},resetStatus(){this.map.removeInteraction(this.draw),this.map.removeInteraction(this.modify),this.map.removeInteraction(this.translate),this.map.removeInteraction(this.transform),this.map.removeInteraction(this.measureInteraction),this.select.getFeatures().clear(),this.select.setActive(!1),this.isSelecting=!1,this.selectedFeatures=[],this.features.forEach((e=>{e.selected&&(e.selected=!1)}))},onCheckChange(){if(!this.map)return;let e=null;this.layers.forEach((t=>{t.layer.setVisible(this.checks.includes(t.name)),t.name===this.checks[this.checks.length-1]&&(e=t.locate,tt.log(e))})),e&&(this.map.getView().setZoom(e[2]),this.map.getView().setCenter([e[0],e[1]]))},addDrawLayer(){this.drawVector=new J.A({source:this.drawSource,style:new X.Ay({fill:new Z.A({color:"rgba(255, 255, 255, 0.2)"}),stroke:new q.A({color:"#ffcc33",width:3}),image:new H.A({radius:7,fill:new Z.A({color:"#ffcc33"})})})}),this.map.addLayer(this.drawVector)},clearDrawLayer(){this.resetStatus(),this.drawVector.getSource().clear(),this.features=[],this.undoStack=[]},drawFeature(e=""){this.resetStatus(),this.draw=new Y.Ay({source:this.drawSource,type:e,style:new X.Ay({fill:new Z.A({color:"rgba(255, 255, 255, 0.8)"}),stroke:new q.A({color:"#ffcc33",width:2}),image:new H.A({radius:7,fill:new Z.A({color:"#ffcc33"})})})}),this.map.addInteraction(this.draw),this.draw.on("drawend",(e=>{const t=e.feature,a=t.getGeometry().getType();let s=this.randomId();t.setId(s),t.setStyle(this.myStyle);let i=0;"Polygon"===a&&(i=t.getGeometry().getArea()),this.features.unshift({id:t.getId(),type:a,area:i,selected:!1}),this.undoStack.push(this.drawSource.getFeatures())}))},undo(){if(this.undoStack.length>=1){let e=this.undoStack[this.undoStack.length-1];this.undoStack.pop(),this.drawSource.clear(),this.drawSource.addFeatures(e),this.features=e}},randomId(){const e=Math.floor(1e4*Math.random());return this.idList.includes(e)?this.randomId():(this.idList.push(e),e)},locateFeature(e){const t=this.drawVector.getSource(),a=t.getFeatures(),s=a.find((t=>t.getId()===e.id));tt.log(a[0]),tt.log(e.id),s&&this.map.getView().fit(s.getGeometry().getExtent())},deleteFeature(e){const t=this.drawVector.getSource(),a=t.getFeatures(),s=a.find((t=>t.getId()===e.id));s&&(t.removeFeature(s),this.features=this.features.filter((t=>t.id!==e.id)))},selectFeature(){this.resetStatus(),this.isSelecting=!0,this.select.setActive(!0);const e=document.getElementById("popup"),t=document.getElementById("popup-content"),a=document.getElementById("popup-closer"),s=new ne.A({element:e,autoPan:{animation:{duration:250}}});a.onclick=function(){return s.setPosition(void 0),a.blur(),!1},this.map.addOverlay(s),this.select.on("select",(function(e){e.target.getFeatures().getArray().forEach((e=>{tt.log(e.values_);let a=e.values_.SQNAME,i=e.values_.drive_Aij_,r=e.values_.walk_Aij_w,o=e.values_.near_Aij_n,n=e.values_.plus_Aij_s;t.innerHTML="<p>地块名称:"+a+"</p><code><p>near_Aij_n:"+o+"</p><p>walk_Aij_w:"+r+"</p><p>drive_Aij_:"+i+"</p><p>plus_Aij_s:"+n+"</p>",s.setPosition(e.getGeometry().getCoordinates())}))})),this.map.on("singleclick",(function(e){const t=e.coordinate;(0,ke.xi)((0,ge.WP)(t));s.setPosition(t)}))},translateFeature(){this.map.removeInteraction(this.draw),this.draw=new Q.A({wrapX:!1}),this.map.addInteraction(this.draw),this.draw.on("select",(e=>{if(e.selected.length>0){const t=e.selected[0];this.enableFeatureTranslate(t)}}))},enableFeatureTranslate(e){this.translate=new K.A({features:new te.A([e])}),this.translate.on("translateend",(e=>{this.map.removeInteraction(this.translate)})),this.map.addInteraction(this.translate)},editVertices(){this.map.removeInteraction(this.draw),this.map.removeInteraction(this.modify),this.modify=new ee.A({source:this.drawSource,style:new X.Ay({image:new H.A({radius:5,stroke:new q.A({color:"rgba(0, 0, 0, 0.7)"}),fill:new Z.A({color:"rgba(255, 255, 255, 0.4)"})}),stroke:new q.A({color:"rgba(0, 0, 0, 0.7)",width:2})})}),this.map.addInteraction(this.modify)},rotateFeature(){this.resetStatus(),this.features.forEach((e=>{const t=this.drawSource.getFeatureById(e.id);t&&this.enableFeatureRotate(t)})),this.defaultStyle=new ee.A({source:this.drawVector.getSource()}).getOverlay().getStyleFunction()},enableFeatureRotate(e){this.transform=new ee.A({source:this.drawSource,features:new te.A([e]),condition:e=>(0,se.fs)(e)&&!(0,se.k5)(e),deleteCondition:se.Zm,insertVertexCondition:se.Zm,style:e=>(e.get("features").forEach((t=>{const a=t.get("modifyGeometry");if(a){const t=e.getGeometry().getCoordinates();let s=a.point;if(!s){s=t,a.point=s,a.geometry0=a.geometry;const e=this.calculateCenter(a.geometry0);a.center=e.center,a.minRadius=e.minRadius}const i=a.center,r=a.minRadius;a.geometry.getCoordinates();let o,n;o=s[0]-i[0],n=s[1]-i[1];const l=Math.sqrt(o*o+n*n);if(l>r){const e=Math.atan2(n,o);o=t[0]-i[0],n=t[1]-i[1];const s=Math.sqrt(o*o+n*n);if(s>0){const t=Math.atan2(n,o),r=a.geometry0.clone();r.scale(s/l,void 0,i),r.rotate(t-e,i),a.geometry=r}}}})),this.defaultStyle(e))}),this.map.addInteraction(this.transform),this.transform.on("modifystart",(e=>{e.features.forEach((e=>{e.set("modifyGeometry",{geometry:e.getGeometry().clone()},!0)}))})),this.transform.on("modifyend",(e=>{e.features.forEach((e=>{const t=e.get("modifyGeometry");t&&(e.setGeometry(t.geometry),e.unset("modifyGeometry",!0))}))}))},changeInteraction(){null!==this.transform&&this.map.removeInteraction(this.transform),null!==this.transform&&(this.transform.on("modifystart",(e=>{e.features.forEach((e=>{e.set("modifyGeometry",{geometry:e.getGeometry().clone()},!0)}))})),this.transform.on("modifyend",(e=>{e.features.forEach((e=>{const t=e.get("modifyGeometry");t&&(e.setGeometry(t.geometry),e.unset("modifyGeometry",!0))}))})))},calculateCenter(e){let t,a,s;const i=e.getType();if("Polygon"===i){let s=0,i=0,r=0;a=e.getCoordinates()[0].slice(1),a.forEach((e=>{s+=e[0],i+=e[1],r++})),t=[s/r,i/r]}else"LineString"===i?(t=e.getCoordinateAt(.5),a=e.getCoordinates()):t=(0,ae.q1)(e.getExtent());let r;return a?(r=a.map((e=>{const a=e[0]-t[0],s=e[1]-t[1];return a*a+s*s})),s=Math.sqrt(Math.max.apply(Math,r))/3):s=Math.max((0,ae.RG)(e.getExtent()),(0,ae.Oq)(e.getExtent()))/3,{center:t,coordinates:a,minRadius:s,sqDistances:r}},measureDistance(){this.resetStatus(),this.measureInteraction=new Y.Ay({source:this.drawSource,type:"LineString",style:new X.Ay({stroke:new q.A({color:"rgba(0, 0, 255, 0.5)",lineDash:[10,10],width:2})})}),this.map.addInteraction(this.measureInteraction),this.measureInteraction.on("drawstart",(e=>{const t=document.createElement("div");t.className="ol-tooltip ol-tooltip-measure",this.createMeasureTooltip(e.feature,t)})),this.measureInteraction.on("drawend",(e=>{const t=e.feature;t.setStyle(new X.Ay({stroke:new q.A({color:"rgba(0, 0, 255, 0.5)",lineDash:[10,10],width:3})}))}))},createMeasureTooltip(e,t){e.getGeometry().getLastCoordinate();t.innerHTML="起点";const a=new ne.A({element:t,offset:[0,-15],positioning:"bottom-center"});let s;this.map.addOverlay(a),e.getGeometry().on("change",(e=>{const s=e.target,i=this.formatLength(s);t.innerHTML=i,a.setPosition(s.getLastCoordinate())})),e.on("change",(()=>{this.map.removeOverlay(a),(0,oe.e)(s)}))},formatLength(e){const t=(0,re.R3)(e);let a;return a=t>100?Math.round(t/1e3*100)/100+" km":Math.round(100*t)/100+" m",a},onZoom(e){if(!this.view)return;const t=this.view.getZoom();this.view.setZoom(e?t+1:t-1)},onMoveWh(){this.view&&(tt.log(this.view),this.view.setCenter([12732996.6685,3551713.9202]),this.view.setZoom(12))},onRestore(){this.view&&(this.view.setZoom(this.zoom),this.view.setCenter(this.center),this.view.setRotation(this.rotation))},onScaleChange(e){this.olmap&&(this.scale&&this.olmap.removeControl(this.scale),this.scale=new be.A({bar:"bar"===e}),this.olmap.addControl(this.scale))},openFileUpload(){this.$refs.fileInput.click()},onFileUpload(e){const t=e.target.files[0];if(t){const t=e.target.files[0],a=t.name.toLowerCase();if(a.endsWith(".json")||a.endsWith(".geojson")){const e=new FileReader;e.onload=e=>{const t=e.target.result;this.loadJsonFile(t)},e.readAsText(t)}else a.endsWith(".zip")?this.loadShapefile(t):tt.error("Unsupported file format.")}},loadJsonFile(e){const t=new ie.A,a=t.readFeatures(e);a.length>0?(this.drawSource.addFeatures(a),a.forEach((e=>{const t=e.getGeometry().getType();let a=0;"Polygon"===t&&(a=e.getGeometry().getArea()),this.features.push({id:e.getId()||this.randomId(),type:t,area:a,selected:!1})})),this.map.getView().fit(this.drawSource.getExtent())):tt.error("No features found in the uploaded file.")},async loadShapefile(e){const t=new FileReader;t.onload=async e=>{const t=e.target.result,a=await this.convertShpToGeoJSON(t);this.displayGeojson(a)},t.readAsArrayBuffer(e)},async convertShpToGeoJSON(e){const t=await(0,de.Ay)(e);let a=[];if(Array.isArray(t))t.forEach((e=>{const t=(new ie.A).readFeatures(e);a.push(...t)}));else{const e=(new ie.A).readFeatures(t);a.push(...e)}return a=a.map((e=>(e.getGeometry().transform("EPSG:4326","EPSG:3857"),e))),a},displayGeojson(e){tt.log(e);let t=null;const a=new X.Ay({fill:new Z.A({color:"rgba(245, 243, 240, 0.6)"}),stroke:new q.A({color:"rgba(102, 102, 115)",width:2}),image:new H.A({radius:7,fill:new Z.A({color:"rgba(255, 255, 255, 0.2)"})})});e.forEach((e=>{e.setStyle(a),this.drawSource.addFeature(e),e.getId()||e.setId(this.randomId()),this.features.push({id:e.getId(),type:e.getGeometry().getType(),area:0,selected:!1});const s=e.getGeometry().getExtent();t=t?[Math.min(t[0],s[0]),Math.min(t[1],s[1]),Math.max(t[2],s[2]),Math.max(t[3],s[3])]:s})),t&&this.map.getView().fit(t)},initMap(){Ce("OSM");this.map=new B.A({target:"mapDom",view:new $.Ay({projection:"EPSG:3857",center:[12758612.973162018,3562849.0216611675],zoom:17.5})}),this.setBasemap("Gaode"),tt.log(this.map),this.view=this.map.getView(),this.zoom=this.view.getZoom(),this.center=this.view.getCenter(),this.rotation=this.view.getRotation();const e=new pe.A,t=new fe.A,a=new we.A;this.map.addControl(e),this.map.addControl(t),this.map.addControl(a);const s=this.map.getLayers().item(0);tt.log(s);const i=new Ee.A({className:"ol-overviewmap ol-custom-overviewmap",collapsed:!1,layers:[new ye.A({source:s.getSource()})]});this.map.addControl(i);const r=new ve.A({coordinateFormat:(0,ke.z)(4),projection:"EPSG:4326"});this.scale=new be.A,this.map.addControl(this.scale),this.map.addControl(r),this.select=new Q.A({condition:se.t5,toggleCondition:se.k5,style:new X.Ay({fill:new Z.A({color:"rgba(255, 255, 0, 0.7)"}),stroke:new q.A({color:"rgba(0, 0, 0, 0.7)",width:2})})}),this.map.addInteraction(this.select)},onFeatureSelectChange(e){const t=this.drawSource.getFeatureById(e.id);e.selected?this.select.getFeatures().push(t):this.select.getFeatures().remove(t),this.selectedFeatures=this.select.getFeatures().getArray()},updateSelectInteraction(){this.draw instanceof Q.A&&(this.draw.getFeatures().clear(),this.draw.getFeatures().extend(this.selectedFeatures))},viewFeatureGeoJSON(e){const t=this.drawSource.getFeatureById(e.id);if(t){const e=(new ie.A).writeFeatureObject(t);this.parsedGeoJSON=e,this.geoJSONViewerVisible=!0}tt.log(this.parsedGeoJSON)},closeGeoJSONViewer(){this.geoJSONViewerVisible=!1},exportFeatureGeoJSON(e){const t=this.drawSource.getFeatureById(e.id);if(t){const a=(new ie.A).writeFeature(t),s=new Blob([a],{type:"application/json"}),i=URL.createObjectURL(s),r=document.createElement("a");r.href=i,r.download=`feature-${e.id}.geojson`,r.click(),URL.revokeObjectURL(i)}}}};const st=(0,c.A)(at,[["render",z],["__scopeId","data-v-e6f882d2"]]);var it=st;const rt=[{path:"/map",name:"map",component:it}],ot=(0,g.aE)({history:(0,g.LA)("/GreenVisPlatform/"),routes:rt});var nt=ot,lt=a(6278),ct=(0,lt.y$)({state:{},mutations:{},actions:{},modules:{}});const dt=(0,s.Ef)(h);window.app1=dt,dt.use(nt),dt.use(ct),dt.use(i.A,{locale:r.A}),dt.config.globalProperties.$echarts=o,dt.mount("#app")},1815:function(e,t,a){"use strict";e.exports=a.p+"img/osm-thumbnail.40ca9c97.jpg"},587:function(e,t,a){"use strict";e.exports=a.p+"img/satellite-thumbnail.55d61326.jpg"},1802:function(){}},t={};function a(s){var i=t[s];if(void 0!==i)return i.exports;var r=t[s]={exports:{}};return e[s].call(r.exports,r,r.exports,a),r.exports}a.m=e,function(){var e=[];a.O=function(t,s,i,r){if(!s){var o=1/0;for(d=0;d<e.length;d++){s=e[d][0],i=e[d][1],r=e[d][2];for(var n=!0,l=0;l<s.length;l++)(!1&r||o>=r)&&Object.keys(a.O).every((function(e){return a.O[e](s[l])}))?s.splice(l--,1):(n=!1,r<o&&(o=r));if(n){e.splice(d--,1);var c=i();void 0!==c&&(t=c)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[s,i,r]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var s in t)a.o(t,s)&&!a.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){a.p="/GreenVisPlatform/"}(),function(){var e={524:0};a.O.j=function(t){return 0===e[t]};var t=function(t,s){var i,r,o=s[0],n=s[1],l=s[2],c=0;if(o.some((function(t){return 0!==e[t]}))){for(i in n)a.o(n,i)&&(a.m[i]=n[i]);if(l)var d=l(a)}for(t&&t(s);c<o.length;c++)r=o[c],a.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return a.O(d)},s=self["webpackChunkwebgis"]=self["webpackChunkwebgis"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))}();var s=a.O(void 0,[504],(function(){return a(9499)}));s=a.O(s)})();
//# sourceMappingURL=app.d9d6ce2b.js.map